# Dumps pronto and LG commnds to the MQTT broker and
# transmits pronto and LG commands from the broker.

remote_transmitter:
  pin: GPIO4
  # Infrared remotes use a 50% carrier signal
  carrier_duty_percent: 50%

remote_receiver:
  pin: 
    number: GPIO14
    inverted: true
  dump: all
  on_pronto:
    then:   
      - mqtt.publish_json:
          topic: ir-blaster/rx/command/pronto
          payload: |-
            root["data"] = x.data;
  on_lg:
    then:   
      - mqtt.publish_json:
          topic: ir-blaster/rx/command/lg
          payload: |-
            root["data"] = x.data;
            root["nbits"] = x.nbits;

mqtt:
  broker: !secret mqtt_broker
  port: !secret mqtt_port
  username: !secret mqtt_username
  password: !secret mqtt_password
  on_json_message:
    - topic: ir-blaster/tx/command/pronto
      then:
        - remote_transmitter.transmit_pronto:
            data: !lambda return x["data"];
    - topic: ir-blaster/tx/command/lg
      then:
        - remote_transmitter.transmit_lg:
            data: !lambda return x["data"];
            nbits: !lambda return x["nbits"];
